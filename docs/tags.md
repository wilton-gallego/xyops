# Tags

Tags are user-defined labels you can attach to events, jobs, and tickets. They serve as lightweight metadata for organization and search, and can also drive automation by triggering conditional job actions. Tags are defined once (with a title, optional icon, and optional notes) and then referenced by ID anywhere tags are supported.

- **Visual**: Tags display alongside events, running jobs, and tickets to quickly convey state such as environment or priority.
- **Search**: Job and ticket searches can be filtered by tags.
- **Automation**: Jobs can add tags dynamically at runtime, and tags can fire actions using tag-based conditions.


## Tag Definitions

A tag definition consists of:

- `id`: Alphanumeric ID auto-generated by xyOps (or provided via API).
- `title`: Display title shown in the UI.
- `icon`: Optional [Material Design Icons](https://pictogrammers.com/library/mdi/) ID.
- `notes`: Optional free-form notes.

Create, edit, and delete tag definitions in the UI, or use the [Tag APIs](api.md#tags). Once defined, tags appear in selection menus (e.g., action condition pickers) and are available for searches.

**Important**: Tag IDs are the reference key used everywhere (including in job action conditions and plugin runtime updates). When in doubt, copy the tag’s ID from the UI. Avoid creating tag IDs that start with an underscore; these are reserved for system tags added by xyOps.


## Where Tags Apply

Tags appear in three places and flow into jobs as they run:

- **Events**: Each event may define a default set of tags. These are applied to job launches, but can be customized when running jobs manually.
- **Jobs**: The running job may accumulate additional tags. Sources include plugins (push updates), workflow nodes, and resource limits. 
- **Tickets**: Tickets can have their own tags and, for each attached event, a ticket can override or supply additional tags to apply to jobs launched from the ticket.


## Dynamic Tagging from Plugins

Event Plugins can add tags to the running job by sending a push update over STDOUT. This is additive only (no replace/remove), and tags are deduped. The tag IDs must refer to existing tag definitions.  Example push message from a Plugin process:

```json
{ "xy": 1, "push": { "tags": ["tmi9dxf3792", "tb359d6dde"] } }
```

Notes:

- Only push is supported for tags during runtime; direct updates to `job.tags` are ignored.
- Tag IDs must exist; define them first in the UI or via API.
- Duplicate tags are removed automatically.

For details on plugin I/O, see [Plugins → Tags](plugins.md#tags).


## Tag-Driven Actions

Actions can be conditioned on the presence of a tag at job completion. When the job completes and contains that tag, the action runs. This allows targeted routing such as “if production then page on-call; if dev then just log.”

- **Timing**: Fires only on job completion.
- **Retry behavior**: Completion actions (including tag-based) run only when a job is not retried.
- **Deduplication**: Actions with identical type/target are deduped so they run once even if contributed from multiple sources.

Example action that emails only when the job completes and the production tag is present:

```json
{
  "enabled": true,
  "condition": "tag:tmi9dxf3792",
  "type": "email",
  "users": ["oncall"],
  "email": "ops@example.com"
}
```

You can select tag-based conditions from the full tag list in the UI.


## Other Ways Tags Are Applied

Beyond event defaults and plugin pushes, tags can also be added by other features:

- **Resource Limits**: Limits on a job (e.g., time, log size, memory, CPU) can apply tags when exceeded. This happens at runtime and shows up in job activity. See actions.md and data.md (Limit objects) for configuration.
- **Workflows**: A workflow node can define tags for its sub-job. After the sub-job completes, user-defined tags (non-underscore) bubble up to the parent workflow job for visibility and search (lib/workflow.js).
- **Tickets**: When a ticket is created via a job action, it will automatically inherit all tags from the job.

## Searching and Filtering

Tags are first-class search filters throughout xyOps. Common uses include:

- **Jobs**: Filter historical jobs by tags (e.g., Production + Sev1).
- **Tickets**: Filter by triage labels (e.g., Sev2, Maintenance).
- **Events**: Use tags to group and locate related automation.

When constructing API queries or using the UI, use tag IDs. Titles are for display only.


## Managing Tags via API

Tag management endpoints are available for automation and CI/CD pipelines:

- [get_tags](api.md#get_tags): List all tags.
- [get_tag](api.md#get_tag): Fetch a tag by ID.
- [create_tag](api.md#create_tag): Create a new tag (title required; id optional; icon/notes optional). Requires [create_tags](privileges.md#create_tags) privilege.
- [update_tag](api.md#update_tag): Update a tag by ID (e.g., title/icon/notes). Requires [edit_tags](privileges.md#edit_tags) privilege.
- [delete_tag](api.md#delete_tag): Delete a tag by ID. Requires [delete_tags](privileges.md#delete_tags) privilege.

Responses follow the standard format and include full [Tag](data.md#tag) objects where applicable.


## Tips and Recommended Tags

Here are some practical, general‑purpose tags you might create:

- **Environments**: `Production`, `Staging`, `Dev`, `QA`
- **Priority/Severity**: `Sev1`, `Sev2`, `Sev3`; `Priority:High`, `Priority:Low`
- **Change windows**: `Freeze`, `Maintenance`
- **Ownership/Teams**: `Team:Ops`, `Team:Payments`
- **Data sensitivity**: `PII`, `Finance`
- **Release labels**: `Release:2025/11`, `Canary`, `Beta`

Guidelines:

- Keep tag titles human-friendly; prefer concise labels that convey meaning quickly.
- Use the UI to create tags so IDs are generated and consistent; if creating IDs via API, use alphanumeric and underscores only.
- Avoid IDs beginning with an underscore (_) to prevent collisions with system tags.
- Define tags before referencing them in events, tickets, actions, or plugin pushes.
